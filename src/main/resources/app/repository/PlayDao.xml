<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="app.repository.PlayDao">
   	<!-- <select id="findChallenge" resultType="app.entity.Play">
		SELECT *
			FROM challenges AS ch
			INNER JOIN (SELECT CEIL(RAND() * (SELECT MAX(challenge_id) FROM challenges)) AS id) AS tmp
			ON ch.challenge_id = tmp.id
   	</select>
   	-->

   	<select id="findAll" resultType="app.entity.Play">
		SELECT * FROM challenges
   	</select>

	<select id="findById" resultType="app.entity.Play">
		SELECT challenge FROM challenges
			WHERE challenge_id = #{currentChallengeId}
   	</select>

   	<insert id="insert">
   		INSERT INTO inputs(current_challenge_id, sentiment_type, input, score)
   			VALUES(#{currentChallengeId}, #{sentimentType}, #{input}, #{score});
   	</insert>

   	<select id="findRank" resultType="app.entity.Play">
		SELECT input, score FROM inputs
			WHERE current_challenge_id = #{currentChallengeId}
					AND sentiment_type = #{sentimentType}
			ORDER BY score DESC limit 5;
   	</select>

   	<select id="findYourRank" resultType="app.entity.Play">
		SELECT COUNT(*)+1 AS your_rank
			FROM inputs
			WHERE current_challenge_id = #{currentChallengeId}
					AND sentiment_type = #{sentimentType}
					AND score > #{score};
   	</select>
</mapper>